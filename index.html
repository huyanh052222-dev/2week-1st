<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Cloud</title>
    <link rel="stylesheet" href="style.css">
    <script src="main.js" defer></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
</head>
<body>
    <div class="container-sidebar">
        <div class="side-bar">
            <div class="sidebar-header">
                <div class="eirlys-logo">EL</div>
                Eirlys
                <!-- <div class="link-integrations">ü¶äüî•</div> -->
            </div>
            
            <div class="main-menu">
                <a href="index.html" class="side-item active-nav" title="Trang Ch·ªß">
                    <i class="fas fa-home"></i> Trang Ch·ªß
                </a>
                <a href="rate.html" class="side-item" title="ƒê√°nh Gi√°">
                    <i class="fas fa-file-invoice"></i> ƒê√°nh gi√°
                </a>
                <a href="contact.html" class="side-item" title="Li√™n L·∫°c">
                    <i class="fas fa-address-book"></i> Li√™n L·∫°c
                </a>
                <a href="#" class="side-item" id="add-page-sidebar-btn" title="Th√™m trang">
                    <i class="fas fa-plus"></i> Th√™m trang 
                </a>
            </div>

            <div class="bottom-menu">
                <a href="#" class="side-item" title="C√¥ng c·ª•">
                    <i class="fas fa-tools"></i> C√¥ng c·ª•
                </a>
                <a href="#" class="side-item" title="Tr·ª£ gi√∫p">
                    <i class="fas fa-question-circle"></i> Tr·ª£ gi√∫p
                </a>
            </div>
        </div>
    </div>

<div class="container-wrap-content">
    <button id="prev-page-btn" class="nav-btn left-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    <div class="book" id="book"></div>
    <button id="next-page-btn" class="nav-btn right-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>
    </button>
</div>

<button id="toggle-toolbar-menu">
    <i class="fas fa-bars"></i>
</button>

<div id="floating-menu">
    <div class="menu-group style-buttons">
        <button data-cmd="bold">B</button>
        <button data-cmd="italic">I</button>
        <button data-cmd="underline">U</button>
    </div>
    
    <div class="menu-group select-row">
        <select id="font-family">
            <option value="Inter, sans-serif">Inter</option>
            <option value="Nunito, sans-serif">Nunito</option>
            <option value="Arial, sans-serif">Arial</option>
            <option value="Pacifico, cursive">Handwriting</option>
        </select>
        <select id="font-size">
            <option value="16px">Normal</option>
            <option value="14px">Small</option>
            <option value="18px">Medium</option>
            <option value="24px">Large</option>
        </select>
    </div>
    
    <div class="menu-group color-row">
        <label for="color">M√†u ch·ªØ:</label>
        <input type="color" id="color" value="#2c2c2c">
    </div>

    <div class="menu-group align-buttons">
        <button data-cmd="justifyLeft" class="align-btn active-align">CƒÉn Tr√°i</button>
        <button data-cmd="justifyCenter" class="align-btn">CƒÉn Gi·ªØa</button>
        <button data-cmd="justifyRight" class="align-btn">CƒÉn Ph·∫£i</button>
        <button data-cmd="justifyFull" class="align-btn">CƒÉn ƒê·ªß</button>
    </div>

    <div class="menu-group action-buttons">
        <button id="insert-image-btn" class="action-btn link-button">
            <i class="fas fa-image"></i> Th√™m ·∫£nh
        </button>
        <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
        
        <button data-cmd="createLink" class="action-btn link-button">üîó Th√™m Li√™n k·∫øt</button>
        <button id="add-page-panel-btn" class="action-btn add-page-button">‚ûï Th√™m trang m·ªõi</button>
    </div>
</div>

<button id="music-toggle" style="position: fixed; top: 20px; right: 80px; font-size: 24px; cursor: pointer; z-index: 2000; background: none; border: none; color: white;">üîä</button>

<audio id="bgMusic" loop autoplay>
    <source src="c√≥ h·∫πn v·ªõi thanh xu√¢n - MONSTAR _ official music video.mp3" type="audio/mpeg">
</audio>
<script>
    const book = document.getElementById('book');
const prevBtn = document.getElementById('prev-page-btn');
const nextBtn = document.getElementById('next-page-btn');
const addPageSidebarBtn = document.getElementById('add-page-sidebar-btn');

const floatingMenu = document.getElementById('floating-menu');
const toggleToolbarMenu = document.getElementById('toggle-toolbar-menu');
const addPagePanelBtn = document.getElementById('add-page-panel-btn');

const insertImageBtn = document.getElementById('insert-image-btn');
const imageUploadInput = document.getElementById('image-upload-input');
const musicToggle = document.getElementById('music-toggle');
const bgMusic = document.getElementById('bgMusic');

let pages = [], currentPage = 0;
let savedRange = null;

// C√°c Layout m·∫´u (Code 2)
const Layouts = {
    COVER: `
        <div class="front book-cover">
            <div class="cover-title-main">Eirlys</div>
            <div class="cover-title-sub">N∆°i l∆∞u gi·ªØ k·ªâ ni·ªám</div>
            <div class="cover-image-placeholder">·∫¢nh</div>
            <button class="cover-start-btn" id="start-btn">B·∫Øt ƒë·∫ßu</button>
        </div>
        <div class="back"></div>
    `,
    
    PAGE_1_LAYOUT: `
        <div class="front layout-container layout-front-2">
            <div class="block-top"></div>
            <div class="block-mid-group">
                <div class="block-mid-left"></div>
                <div class="block-mid-right"></div>
            </div>
            <div class="block-large-mid"></div>
            <div class="block-bottom"></div>
            <div class="footer-dots"><div class="dot active"></div><div class="dot"></div></div>
        </div>
        <div class="back layout-container layout-back-2">
            <div class="block-top-group">
                <div class="block-left"></div>
                <div class="block-right"></div>
            </div>
            <div class="block-bottom">Frame 41</div>
            <div class="footer-dots"><div class="dot"></div><div class="dot active"></div></div>
        </div>
    `,
    
    PAGE_BLANK: `
        <div class="front content"></div>
        <div class="back content"></div>
    `
};

// --- CH·ª®C NƒÇNG L∆ØU/KH√îI PH·ª§C CON TR·ªé (QUAN TR·ªåNG CHO VI·ªÜC CH√àN ·∫¢NH) ---
function saveSelection() {
    const selection = window.getSelection();
    if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        // ƒê·∫£m b·∫£o ch·ªâ l∆∞u range n·∫øu n√≥ n·∫±m trong m·ªôt v√πng contenteditable
        const container = range.commonAncestorContainer.closest('[contenteditable="true"]');
        if (container) {
            savedRange = range.cloneRange();
        }
    }
}

function restoreSelection() {
    if (savedRange) {
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(savedRange);
    }
}

// --- CH·ª®C NƒÇNG T·∫†O/TH√äM TRANG ---
function createPage(contentTemplate, isEditable = true) {
    const page = document.createElement('div');
    page.className = 'paper';
    page.innerHTML = contentTemplate;
    page.style.zIndex = 100 - pages.length;
    book.appendChild(page);
    pages.push(page);
    
    if (isEditable) {
        page.querySelectorAll('.front, .back').forEach(el => {
            el.setAttribute('contenteditable', 'true');
            el.addEventListener('mouseup', saveSelection);
            el.addEventListener('keyup', saveSelection);
        });
    }
    return page;
}

function addNewPage() {
    // Lu√¥n ƒë·∫£m b·∫£o c√≥ trang cu·ªëi c√πng kh√¥ng l·∫≠t ƒë·ªÉ che ph√≠a sau
    const lastPage = pages.pop();
    if (lastPage) {
        book.removeChild(lastPage);
    }
    
    // Th√™m trang m·ªõi c√≥ th·ªÉ ch·ªânh s·ª≠a
    createPage(Layouts.PAGE_BLANK, true);

    // Th√™m l·∫°i trang cu·ªëi c√πng kh√¥ng l·∫≠t
    createPage(Layouts.PAGE_BLANK, false); 
    
    currentPage = pages.length - 2; // L√πi v·ªÅ trang v·ª´a th√™m
    updatePages();
}

function updatePages() {
    pages.forEach((p, i) => {
        if (i < currentPage) {
            p.classList.add('flipped');
            p.style.zIndex = i; 
        } else {
            p.classList.remove('flipped');
            p.style.zIndex = pages.length - i; 
        }
    });

    prevBtn.disabled = currentPage === 0;
    nextBtn.disabled = currentPage === pages.length - 1;
}


// --- CH·ª®C NƒÇNG C√îNG C·ª§ CH·ªàNH S·ª¨A ---
floatingMenu.querySelectorAll('button[data-cmd]').forEach(btn => {
    btn.addEventListener('click', () => {
        restoreSelection();
        const cmd = btn.dataset.cmd;
        if (cmd === 'createLink') {
            const url = prompt("Nh·∫≠p URL:");
            if (url) document.execCommand(cmd, false, url);
        } else if (cmd.startsWith('justify')) {
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i active cho n√∫t cƒÉn l·ªÅ
            floatingMenu.querySelectorAll('.align-buttons .align-btn').forEach(b => b.classList.remove('active-align'));
            btn.classList.add('active-align');
            document.execCommand(cmd, false, null);
        } else {
            document.execCommand(cmd, false, null);
        }
    });
});

document.getElementById('font-family').addEventListener('change', e => {
    restoreSelection();
    document.execCommand('fontName', false, e.target.value);
});

document.getElementById('font-size').addEventListener('change', e => {
    restoreSelection();
    // Chuy·ªÉn size: 14px -> 3, 16px -> 4, 18px -> 5, 24px -> 6 (Do execCommand ch·ªâ ch·∫•p nh·∫≠n size 1-7)
    let sizeValue = '4';
    switch(e.target.value) {
        case '14px': sizeValue = '3'; break; 
        case '18px': sizeValue = '5'; break; 
        case '24px': sizeValue = '6'; break; 
    }
    document.execCommand('fontSize', false, sizeValue);
});

document.getElementById('color').addEventListener('change', e => {
    restoreSelection();
    document.execCommand('foreColor', false, e.target.value);
});

// --- LOGIC T·∫¢I ·∫¢NH L√äN ---
insertImageBtn.addEventListener('click', () => {
    imageUploadInput.click();
});

imageUploadInput.addEventListener('change', function(event) {
    if (event.target.files && event.target.files[0]) {
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
            restoreSelection(); 
            if (savedRange && savedRange.commonAncestorContainer.closest('[contenteditable="true"]')) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = 'Uploaded Image';
                
                // Ch√®n ·∫£nh v√†o v·ªã tr√≠ con tr·ªè
                savedRange.deleteContents();
                savedRange.insertNode(img);
                
                // ƒê·∫∑t l·∫°i con tr·ªè sau ·∫£nh
                savedRange.setEndAfter(img);
                savedRange.collapse(false);
                
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(savedRange);

                // Th√™m d√≤ng m·ªõi sau ·∫£nh ƒë·ªÉ d·ªÖ so·∫°n th·∫£o ti·∫øp
                document.execCommand('insertHTML', false, '<br><br>');

            } else {
                alert('Vui l√≤ng click v√†o v·ªã tr√≠ b·∫°n mu·ªën ch√®n ·∫£nh tr∆∞·ªõc khi nh·∫•n n√∫t "Th√™m ·∫£nh".');
            }
        };

        reader.readAsDataURL(file);
    }
    event.target.value = ''; 
});

// --- KH·ªûI T·∫†O V√Ä S·ª∞ KI·ªÜN CHUNG ---
prevBtn.addEventListener('click', () => {
    if (currentPage > 0) currentPage--;
    updatePages();
});

nextBtn.addEventListener('click', () => {
    if (currentPage < pages.length - 1) currentPage++;
    updatePages();
});

addPageSidebarBtn.addEventListener('click', (e) => {
    e.preventDefault();
    addNewPage();
});

addPagePanelBtn.addEventListener('click', addNewPage);

toggleToolbarMenu.addEventListener('click', () => {
    floatingMenu.classList.toggle('show');
});

musicToggle.addEventListener('click', () => {
    if (bgMusic.paused) { bgMusic.play(); musicToggle.textContent = 'üîä'; }
    else { bgMusic.pause(); musicToggle.textContent = 'üîá'; }
});


function initBook() {
    book.innerHTML = '';
    pages = [];
    currentPage = 0;

    // B√¨a
    createPage(Layouts.COVER, false);
    
    // Trang m·∫´u 1
    createPage(Layouts.PAGE_1_LAYOUT, true);

    // Th√™m trang tr·∫Øng c√≥ th·ªÉ ch·ªânh s·ª≠a
    createPage(Layouts.PAGE_BLANK, true);

    // Trang cu·ªëi c√πng (kh√¥ng l·∫≠t)
    createPage(Layouts.PAGE_BLANK, false);

    updatePages();
    
    const startBtn = document.getElementById('start-btn');
    if (startBtn) {
        startBtn.addEventListener('click', () => {
            currentPage = 1; 
            updatePages();
        });
    }
}

initBook();
(function(){
  const AUTO_MS=6000;
  const TRANSITION=500;
  const cardsSource=document.querySelector('.cards-source');
  if(!cardsSource) return;
  const cardNodes=Array.from(cardsSource.querySelectorAll('.testimonial-card'));
  if(!cardNodes.length) return;
  const sliderRoot=document.querySelector('.slider-root');
  const dotsRoot=document.querySelector('.dots-root');
  const track=document.createElement('div');
  track.className='slider-track';
  const PALETTE=['#C8F7E0','#E6D8FF','#D7EAFE'];
  const MINT='#C8F7E0';
  cardNodes.forEach((card,i)=>{
    track.appendChild(card);
    const base=PALETTE[i%PALETTE.length];
    card.dataset.baseColor=base;
    card.style.background=base;
  });
  sliderRoot.appendChild(track);
  const dots=[];
  cardNodes.forEach((_,i)=>{
    const b=document.createElement('button');
    b.type='button';
    b.dataset.index=i;
    b.addEventListener('click',()=>{ goTo(i); restartAuto(); });
    dotsRoot.appendChild(b);
    dots.push(b);
  });
  dotsRoot.style.display='flex';
  const gap=parseInt(getComputedStyle(track).gap)||20;
  const cardRect=cardNodes[0].getBoundingClientRect();
  const cardW=Math.round(cardRect.width)||320;
  const sliderWidth=sliderRoot.clientWidth;
  const centerOffset=(sliderWidth/2)-(cardW/2);
  let index=0;
  const total=cardNodes.length;
  let autoTimer=null;
  function clampIdx(i){ return ((i%total)+total)%total; }
  function applyClasses(){
    cardNodes.forEach(c=>{ c.classList.remove('center','side','dim'); });
    const c=clampIdx(index);
    const left=clampIdx(index-1);
    const right=clampIdx(index+1);
    cardNodes[c].classList.add('center');
    cardNodes[c].style.background=MINT;
    if(cardNodes[left]){
      cardNodes[left].classList.add('side');
      cardNodes[left].style.background=cardNodes[left].dataset.baseColor;
    }
    if(cardNodes[right]){
      cardNodes[right].classList.add('side');
      cardNodes[right].style.background=cardNodes[right].dataset.baseColor;
    }
    cardNodes.forEach((card,idx)=>{
      if(idx!==c && idx!==left && idx!==right){
        card.classList.add('dim');
        card.style.background=card.dataset.baseColor;
      }
    });
    dots.forEach((d,i)=>d.classList.toggle('active',i===c));
  }
  function updatePosition(animate=true){
    const x=-(index*(cardW+gap))+centerOffset;
    if(!animate){
      track.style.transition='none';
      track.style.transform=`translateX(${x}px)`;
      void track.offsetWidth;
      track.style.transition=`transform ${TRANSITION}ms ease`;
    } else {
      track.style.transform=`translateX(${x}px)`;
    }
    applyClasses();
  }
  function goTo(i){ index=clampIdx(i); updatePosition(true); }
  function next(){ goTo(index+1); }
  function prev(){ goTo(index-1); }
  function startAuto(){ stopAuto(); autoTimer=setInterval(()=>{ next(); },AUTO_MS); }
  function stopAuto(){ if(autoTimer){ clearInterval(autoTimer); autoTimer=null; } }
  function restartAuto(){ stopAuto(); startAuto(); }
  sliderRoot.addEventListener('mouseenter',stopAuto);
  sliderRoot.addEventListener('mouseleave',startAuto);
  sliderRoot.addEventListener('focusin',stopAuto);
  sliderRoot.addEventListener('focusout',startAuto);
  window.addEventListener('keydown',(e)=>{ if(e.key==='ArrowLeft'){ prev(); restartAuto(); } if(e.key==='ArrowRight'){ next(); restartAuto(); } });
  track.addEventListener('click',(ev)=>{
    const card=ev.target.closest('.testimonial-card');
    if(!card) return;
    const i=cardNodes.indexOf(card);
    if(i===-1) return;
    if(i!==index){ goTo(i); restartAuto(); }
  });
  index=1<total?1:0;
  track.style.transition=`transform ${TRANSITION}ms ease`;
  updatePosition(false);
  startAuto();
  window.__testimonialSlider={ goTo, next, prev, startAuto, stopAuto };
})();
</script>
</body>
</html>